# –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Yandex Cloud —Å GPU

## –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã

### 1. –ö–∞–∫–∏–º —Å–µ—Ä–≤–∏—Å–æ–º –ª—É—á—à–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: Yandex Compute Cloud (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã —Å GPU)**

**–ü–æ—á–µ–º—É:**
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º
- ‚úÖ –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–≤—ã–±–æ—Ä GPU, CPU, RAM, –¥–∏—Å–∫–∞)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–æ–ø–ª–∞—Ç–∞ —Ç–æ–ª—å–∫–æ –∑–∞ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±—ã–µ –º–æ–¥–µ–ª–∏ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
- **Yandex DataSphere** ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –≤ Jupyter, –Ω–æ –º–µ–Ω–µ–µ –≥–∏–±–∫–æ
- **Yandex ML Platform** ‚Äî –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω, –Ω–æ –∏–∑–±—ã—Ç–æ—á–Ω–æ –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

### 2. –ù—É–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –∫–æ–¥?

**–ù–ï–¢, –∫–æ–¥ —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç GPU!** ‚úÖ

–í–∞—à –∫–æ–¥ —É–∂–µ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å GPU:
- ‚úÖ –í `src/config.py` –ø–∞—Ä–∞–º–µ—Ç—Ä `device="auto"` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç GPU
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_device()` –≤ `src/utils.py` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç CUDA –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞
- ‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `.to(device)`, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–ª—è CPU, –∏ –¥–ª—è GPU

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PyTorch —Å CUDA –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–∞ GPU-–º–∞—à–∏–Ω–µ
2. –£–≤–µ–ª–∏—á–∏—Ç—å `batch_size` –¥–ª—è GPU (32-64 –≤–º–µ—Å—Ç–æ 8)
3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –º–æ—â–Ω—ã–µ –º–æ–¥–µ–ª–∏

### 3. –ù—É–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –Ω–∞ –º–æ–¥–µ–ª–∏ –ø–æ–ª—É—á—à–µ?

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞**

**–¢–µ–∫—É—â–∏–µ –º–æ–¥–µ–ª–∏ (—Ö–æ—Ä–æ—à–∏ –¥–ª—è –Ω–∞—á–∞–ª–∞):**
- Student: `distilbert-base-uncased` (66M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤) ‚Äî –±—ã—Å—Ç—Ä–∞—è, –ª–µ–≥–∫–∞—è
- Teachers: `bert-base-uncased`, `roberta-base` (110-125M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:**

#### –î–ª—è Student (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –º–æ—â–Ω—ã–µ –Ω–∞ GPU):
1. **`bert-base-uncased`** –∏–ª–∏ **`roberta-base`** –≤–º–µ—Å—Ç–æ DistilBERT
   - –ë–æ–ª—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ‚Üí –ª—É—á—à–µ –∫–∞—á–µ—Å—Ç–≤–æ
   - –ù–∞ GPU –æ–±—É—á–µ–Ω–∏–µ –≤—Å–µ —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç –±—ã—Å—Ç—Ä—ã–º

2. **–ë–∏–æ–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –º–æ–¥–µ–ª–∏** (–ª—É—á—à–µ –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∑–∞–¥–∞—á):
   - `emilyalsentzer/Bio_ClinicalBERT`
   - `dmis-lab/biobert-base-cased-v1.2` (BioBERT)
   - `microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract-fulltext`

#### –î–ª—è Teacher Ensemble (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –º–æ—â–Ω—ã–µ):
1. **`bert-large-uncased`** (340M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤) ‚Äî –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ª—É—á—à–µ base-–≤–µ—Ä—Å–∏–∏
2. **`roberta-large`** (355M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤) ‚Äî –æ–¥–Ω–∞ –∏–∑ –ª—É—á—à–∏—Ö –¥–ª—è MCQA
3. **–ë–∏–æ–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ large-–º–æ–¥–µ–ª–∏:**
   - `dmis-lab/biobert-large-cased-v1.1`
   - `microsoft/BiomedNLP-PubMedBERT-large-uncased-abstract-fulltext`

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–ª—É—á—à–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏:**

–í –∫–æ–¥–µ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `improved_medqa_experiment()` –≤ `src/config.py`:

```python
from src.config import improved_medqa_experiment

config = improved_medqa_experiment(
    experiment_name="medqa_improved",
    experiment_type="kd",
    use_full_dataset=True,
    gpu_optimized=True,
)
```

–ò–ª–∏ —á–µ—Ä–µ–∑ CLI (—Å–∫—Ä–∏–ø—Ç—ã —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ):
```bash
python3 scripts/train_supervised.py \
    --experiment_name "supervised_bert_base" \
    --student_model_name "bert-base-uncased" \
    --batch_size 32 \
    --num_epochs 5
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–π—Ç–µ VM –≤ Yandex Cloud
- GPU: Tesla T4 –∏–ª–∏ V100
- RAM: 32-64 GB
- –î–∏—Å–∫: 200-500 GB SSD
- –û–±—Ä–∞–∑: Ubuntu 22.04

### 2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ setup
```bash
ssh ubuntu@<PUBLIC_IP>
cd ~/projects/"Iterative Expert-Guided Fine-Tuning"
bash setup_gpu.sh
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ
```bash
source venv/bin/activate
python3 scripts/train_supervised.py \
    --experiment_name "supervised_gpu_full" \
    --batch_size 32 \
    --num_epochs 5 \
    --max_samples None
```

## –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`DEPLOY_YANDEX_CLOUD.md`** ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
2. **`setup_gpu.sh`** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. **`requirements-gpu.txt`** ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è GPU
4. **`improved_medqa_experiment()`** ‚Äî —Ñ—É–Ω–∫—Ü–∏—è —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ –≤ `src/config.py`

## –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

**–ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ü–µ–Ω—ã:**
- Tesla T4: ~150-200 —Ä—É–±/—á–∞—Å
- Tesla V100: ~300-400 —Ä—É–±/—á–∞—Å

**–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è (–ø—Ä–∏–º–µ—Ä–Ω–æ):**
- Baseline 1 (5 —ç–ø–æ—Ö, –ø–æ–ª–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç): 2-4 —á–∞—Å–∞
- Baseline 2 (5 —ç–ø–æ—Ö): 3-5 —á–∞—Å–æ–≤
- Baseline 3 (5 —ç–ø–æ—Ö): 4-6 —á–∞—Å–æ–≤

**–ò—Ç–æ–≥–æ:** –û–¥–∏–Ω –ø–æ–ª–Ω—ã–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç ~10-15 —á–∞—Å–æ–≤ = 1500-3000 —Ä—É–± (–Ω–∞ T4)

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å GPU (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
2. üìù –°–æ–∑–¥–∞–π—Ç–µ VM –≤ Yandex Cloud
3. üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–µ `setup_gpu.sh` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
4. üéØ –ù–∞—á–Ω–∏—Ç–µ —Å –Ω–µ–±–æ–ª—å—à–∏—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
5. üìä –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–ª—É—á—à–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏:** –°–º. `DEPLOY_YANDEX_CLOUD.md`

